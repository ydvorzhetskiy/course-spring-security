<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="description" content="01 - Основы Spring Security"/>
  <title>01 - Основы Spring Security</title>
  <meta name="author" content="Дворжецкий Юрий">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/browse/reveal.js@4.1.0/dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@4.1.0/dist/reveal.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@4.1.0/dist/theme/white.css">
  <link rel="stylesheet" href="style/theme.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@4.1.0/plugin/highlight/monokai.css">
</head>
<body>
<div class="reveal">
  <div class="slides">
    <section>
      <h2>Фреймворк Spring Security</h2>
      <br>
      <h3>Модуль 01. Основы Spring Security</h3>
      <br>
      <h4 class="right">Дворжецкий Юрий</h4>
    </section>

    <section>
      <section>
        <h3>1.1. Вопросы безопасности</h3>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <p>Какие бывают угрозы безопасности?</p>
        </div>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <p>Какие бывают угрозы безопасности?</p>
          <ul>
            <li>Неправомерный доступ к информации</li>
            <li>Доступ к информации от имени другого пользователя</li>
            <li>Угроза целостности информации</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <p>Как мы можем устранить данные угрозы?</p>
        </div>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <p>Как мы можем устранить данные угрозы?</p>
          <ul>
            <li>Устранение уязвимостей<br>(это технические вопросы, и это не тема данного курса)</li>
            <li>Проверять, что пользователь тот, за кого себя выдаёт</li>
            <li>Предоставлять пользователю доступ только к разрешённой информации</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <p>Как называются данные действия?</p>
          <ul>
            <li>Проверять, что пользователь тот, за кого себя выдаёт</li>
            <li>Предоставлять пользователю доступ только к разрешённой информации</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <p>Как называются данные действия?</p>
          <ul>
            <li><b>Аутентификация</b>&nbsp;&mdash; проверка, что пользователь тот, за кого себя выдаёт.</li>
            <li><b>Авторизация</b>&nbsp;&mdash; предоставление или проверка прав пользователя
              на совершение каких-либо действий.
            </li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <p>Как называются данные действия?</p>
          <ul>
            <li><b>Идентификация</b>&nbsp;&mdash; определение текущего пользователя.</li>
            <li><b>Аутентификация</b>&nbsp;&mdash; проверка, что пользователь тот, за кого себя выдаёт.</li>
            <li><b>Авторизация</b>&nbsp;&mdash; предоставление или проверка прав пользователя
              на совершение каких-либо действий.
            </li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <p>Какие механизмы нужны для этих действий?</p>
        </div>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <p>Какие механизмы нужны для этих действий?</p>
          <ul>
            <li>хранение пользователей;</li>
            <li>хранение паролей (других секретов);</li>
            <li>хранение прав доступа;</li>
            <li>механизмы проверки прав доступа;</li>
            <li>и т.д.</li>
          </ul>
        </div>
      </section>

      <section>
        <div class="center">
          <b>Spring Security</b>&nbsp;&mdash; это фреймворк, содержащий реализации механизмов для поддержания
          аутентификации и авторизации в приложении
        </div>
      </section>

      <section>
        <h2 class="center">Вопросы?</h2>
      </section>
    </section>

    <section>
      <section>
        <h3>1.2. Возможности Spring Security</h3>
      </section>

      <section>
        <h3>Модули Spring Security</h3>
        <div class="r-stretch">
          <ul>
            <li>spring-security-core</li>
            <li>spring-security-web</li>
            <li>spring-security-config</li>
            <li>spring-security-ldap</li>
            <li>spring-security-acl</li>
            <li>spring-security-cas</li>
            <li>spring-security-test</li>
            <li>spring-security-openid</li>
            <li>spring-security-oauth2-core</li>
            <li>spring-security-oauth2-client</li>
            <li>spring-security-oauth2-jose</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Механизмы Spring Security</h3>
        <div class="r-stretch">
          <ul>
            <li>Различные аутентификации</li>
            <li>URL-based авторизация</li>
            <li>Method-based авторизация</li>
            <li>Авторизация на основе доменных сущностей с помощью ACL (Access Control List)</li>
            <li>Идентификация с помощью OAuth 2.0</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Механизмы аутентификации Spring Security</h3>
        <div class="r-stretch">
          <ul>
            <li>HTTP Basic</li>
            <li>Form-based аутентификация</li>
            <li>Remember-me аутентификация</li>
            <li>Анонимная аутентификация</li>
          </ul>
        </div>
      </section>

      <section>
        <h2 class="center">Вопросы?</h2>
      </section>

      <section>
        <h3>Лабораторная №1</h3>
        <div class="r-stretch">
          <ol>
            <li>Взять себе репозиторий с упражнениями</li>
            <li>Разобраться в доменной области</li>
            <li>Разобраться в приложении</li>
            <li>Обратите внимание на реализацию концепции Deny by Default</li>
            <li>Число 1 в чат, как разберётесь</li>
          </ol>
        </div>
      </section>

      <section>
        <h2 class="center">Вопросы?</h2>
      </section>
    </section>

    <section>
      <section>
        <h3>1.3. Основные абстракции Spring Security</h3>
      </section>

      <section>
        <h3>Немного о Spring Security</h3>
        <div class="r-stretch">
          <ul>
            <li>Раньше это был отдельный фреймворк</li>
            <li>И у него была совсем другая внутренняя архитектура</li>
            <li>Но потом стал частью Spring</li>
            <li>Но архитектура и абстракции, в действительности, другие</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <ul>
            <li>Сейчас я буду называть абстракции, а Вы будете их смотреть вместе со мной</li>
            <li>Ctrl + N в IntelliJ IDEA</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Основные абстракции</h3>
        <div class="r-stretch">
          <ul>
            <li><b>SecurityContext</b></li>
            <li>Не имеет отношение к Spring Context</li>
            <li>Является контейнером для объекта Authentication</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Основные абстракции</h3>
        <div class="r-stretch">
          <ul>
            <li><b>SecurityContextHolder</b></li>
            <li>Является контейнером для SecurityContext</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Основные абстракции</h3>
        <div class="r-stretch">
          <ul>
            <li><b>Authentication</b></li>
            <li>Основной класс</li>
            <li>В действительности вся работа происходит именно с ним</li>
            <li>В терминах логин/пароль, principal&nbsp;&mdash;&nbsp;логин,
              а credentials&nbsp;&mdash;&nbsp;пароль
            </li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Основные абстракции</h3>
        <div class="r-stretch center">
          <img alt=""
               src="https://docs.spring.io/spring-security/site/docs/5.3.6.RELEASE/reference/html5/images/servlet/authentication/architecture/securitycontextholder.png"/>
        </div>
      </section>

      <section>
        <h3>Основные абстракции</h3>
        <div class="r-stretch">
          <ul>
            <li><b>GrantedAuthority</b></li>
            <li>Атомарное &laquo;разрешение&raquo; для пользователя</li>
            <li>Реализации используются для авторизации</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Основные абстракции</h3>
        <div class="r-stretch">
          <ul>
            <li><b>UserDetails</b></li>
            <li>Объект, представляющий абстракцию пользователя</li>
            <li>После успешной аутентификации возвращается в principal</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Основные абстракции</h3>
        <div class="r-stretch">
          <ul>
            <li><b>UserDetailsService</b></li>
            <li>Сервис для хранения пользователей</li>
            <li>Его можете реализовать самостоятельно, а можете использовать готовый</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Основные абстракции</h3>
        <div class="r-stretch">
          <ul>
            <li><b>AuthenticationManager</b></li>
            <li>Осуществляет аутентификацию</li>
            <li>На самом деле, делегирует AuthenticationProvider-ам</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Основные абстракции</h3>
        <div class="r-stretch">
          <ul>
            <li><b>AuthenticationProvider</b></li>
            <li>Собственно и осуществляет аутентификацию</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Основные абстракции</h3>
        <div class="r-stretch">
          <ul>
            <li><b>PasswordEncoder</b></li>
            <li>Решает задачу хранения паролей</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>ДЕМО</h3>
        <div class="r-stretch">
          <ol>
            <li>Реализация UserDetailsAdapter</li>
            <li>Реализация UserDetailsServiceImpl</li>
            <li>Подключение UserDetailsServiceImpl в AuthenticationManager</li>
            <li>Подключение NoOpPasswordEncoder в AuthenticationManager</li>
          </ol>
        </div>
      </section>

      <section>
        <h2 class="center">Вопросы?</h2>
      </section>

      <section>
        <h3>Лабораторная №2</h3>
        <div class="r-stretch">
          <ol>
            <li>Написать собственный UserDetailsAdapter.</li>
            <li>Написать собственный UserDetailsServiceImpl.</li>
            <li>Интегрировать UserDetailsService в SecurityConfig.</li>
            <li>Написать специальные методы UserRepository/сделать роли Eager.</li>
            <li>*Добавить BCryptPasswordEncoder, исправить хранимые пароли в БД и сохранение пользователей.</li>
            <li>Число 2 в чат, как сделаете</li>
          </ol>
        </div>
      </section>

      <section>
        <h2 class="center">Вопросы?</h2>
      </section>
    </section>

    <section>
      <section>
        <h3>1.4. Интеграция с Web</h3>
      </section>

      <section>
        <h3>Немного о Servlet API</h3>
        <div class="r-stretch">
          <ul>
            <li>Это зрелая технология</li>
            <li>С её использованием так или иначе написано большинство приложений</li>
            <li>Spring MVC использует как раз Servlet API</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Немного о Servlet API</h3>
        <div class="r-stretch center">
          <img alt=""
               src="https://docs.spring.io/spring-security/site/docs/5.3.6.RELEASE/reference/html5/images/servlet/architecture/filterchain.png"/>
        </div>
      </section>

      <section>
        <h3>Spring Security в Web</h3>
        <div class="r-stretch">
          <ul>
            <li>Spring Security в Web встраивается именно в Servlet API, не в Spring MVC.</li>
            <li>Это, в частности, позволяет использовать Spring Security c другими Web-фреймворками.</li>
            <li>Вы этого не увидите, но есть специальный Servlet&nbsp;&mdash;&nbsp;DelegatingFilterProxy</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Spring Security в Web</h3>
        <div class="r-stretch center">
          <img alt=""
               src="https://docs.spring.io/spring-security/site/docs/5.3.6.RELEASE/reference/html5/images/servlet/architecture/delegatingfilterproxy.png"/>
        </div>
      </section>

      <section>
        <h3>Spring Security в Web</h3>
        <div class="r-stretch">
          <ul>
            <li>А уже у этого сервлета есть своя цепочка фильтров&nbsp;&mdash;&nbsp;SecurityFilterChain</li>
            <li>Они не являются фильтрами Servlet API</li>
            <li>И у каждого фильтра своё назначение</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Spring Security в Web</h3>
        <div class="r-stretch center">
          <img alt=""
               src="https://docs.spring.io/spring-security/site/docs/5.3.6.RELEASE/reference/html5/images/servlet/architecture/filterchainproxy.png"/>
        </div>
      </section>

      <section>
        <h3>Spring Security в Web</h3>
        <div class="r-stretch center">
          <img alt=""
               src="https://docs.spring.io/spring-security/site/docs/5.3.6.RELEASE/reference/html5/images/servlet/architecture/securityfilterchain.png"/>
        </div>
      </section>

      <section>
        <h3>Spring Security в Web</h3>
        <div class="r-stretch center">
          <img alt=""
               src="https://docs.spring.io/spring-security/site/docs/5.3.6.RELEASE/reference/html5/images/servlet/architecture/multi-securityfilterchain.png"/>
        </div>
      </section>

      <section>
        <h3>Фильтры Spring Security</h3>
        <div class="r-stretch">
          <ul>
            <li>Какие-то из них делают много работы, какие-то совсем чуть-чуть.</li>
            <li>Каждый из них отвечает за какой-то аспект безопасности или обработки запроса.</li>
            <li>Полный список фильтров можно найти
              <a
                href="https://docs.spring.io/spring-security/site/docs/5.3.6.RELEASE/reference/html5/#servlet-security-filters">
                здесь</a>.
            </li>
            <li>Да, и Вы можете создавать свои собственные фильтры.</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Фильтры Spring Security</h3>
        <div class="r-stretch">
          <ul>
            <li>ChannelProcessingFilter</li>
            <li>SecurityContextPersistenceFilter</li>
            <li>HeaderWriterFilter</li>
            <li>CorsFilter</li>
            <li>CsrfFilter</li>
            <li>LogoutFilter</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Фильтры Spring Security</h3>
        <div class="r-stretch">
          <ul>
            <li>UsernamePasswordAuthenticationFilter</li>
            <li>OpenIDAuthenticationFilter</li>
            <li>BearerTokenAuthenticationFilter</li>
            <li>BasicAuthenticationFilter</li>
            <li>RememberMeAuthenticationFilter</li>
            <li>AnonymousAuthenticationFilter</li>
            <li>SessionManagementFilter</li>
            <li>ExceptionTranslationFilter</li>
            <li>FilterSecurityInterceptor</li>
          </ul>
        </div>
      </section>

      <!-- TODO: описание всех фильтров -->
      <section>
        <h3>SecurityInterceptor</h3>
        <div class="r-stretch">
          <ul>
            <li>Всё работу по аутентификации и авторизации осуществляет FilterSecurityInterceptor.</li>
            <li>Но это не единственный SecurityInterceptor в окружении.</li>
            <li>Для Method-based авторизации существует ещё MethodSecurityInterceptor,
              который также осуществляет авторизацию, но вызывается не из цепочки фильтров, а из аспектов.</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Упражнение</h3>
        <div class="r-stretch">
          <ol>
            <li>Запустите Ваше приложение</li>
            <li>Посмотрите в логе, какие фильтры у Вас доступны</li>
          </ol>
        </div>
      </section>

      <section>
        <h2 class="center">Вопросы?</h2>
      </section>
    </section>

    <section>
      <h2 class="center">Спасибо за внимание!</h2>
    </section>
  </div>
</div>
<!-- Reveal JS -->
<script src="https://unpkg.com/reveal.js@4.1.0/dist/reveal.js"></script>
<script src="https://unpkg.com/reveal.js@4.1.0/plugin/highlight/highlight.js"></script>
<script src="js/reveal-init.js"></script>
</body>
</html>
